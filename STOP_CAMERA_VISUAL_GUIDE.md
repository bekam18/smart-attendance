# Stop Camera & Session Management - Visual Guide

## Quick Reference

### Three Session Actions

| Action | Button | What It Does | Can Reopen? |
|--------|--------|--------------|-------------|
| **Stop Camera** | ğŸŸ  Orange | Ends session for the day, marks absent students | âœ… Yes (after 12 hours) |
| **End Session** | ğŸ”´ Red | Permanently ends session for semester | âŒ No |
| **Reopen Session** | ğŸŸ¢ Green | Reactivates stopped session | - |

---

## 1. Stop Camera (Daily End)

### When to Use
- End of class for the day
- Want to retake attendance tomorrow
- Need to mark absent students

### How It Works
```
Active Session â†’ Stop Camera â†’ Marks Absent â†’ Stopped (Daily) â†’ Wait 12h â†’ Can Reopen
```

### Steps
1. **During Active Session:**
   - Click "Stop Camera" button (orange)
   - Confirm: "Stop camera and mark absent students?"

2. **What Happens:**
   - âœ… All students not present are marked absent
   - âœ… Session status changes to "ğŸŸ  Stopped (Daily)"
   - âœ… Camera stops
   - âœ… Returns to dashboard

3. **After 12 Hours:**
   - Session shows "ğŸ”„ Reopen Session" button
   - Click to reactivate session
   - Old attendance records preserved

### Visual Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Active Session â”‚
â”‚   ğŸŸ¢ Camera On  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Click "Stop Camera"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stopped (Daily) â”‚
â”‚  ğŸŸ  Wait 12h    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ After 12 hours
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Can Reopen Now  â”‚
â”‚  ğŸ”„ Click Here  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Click "Reopen"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Active Again   â”‚
â”‚   ğŸŸ¢ Camera On  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. End Session (Semester End)

### When to Use
- Semester is ending
- Course is complete
- No more attendance needed

### How It Works
```
Active Session â†’ End Session â†’ Ended (Semester) â†’ Cannot Reopen
```

### Steps
1. **During Active Session:**
   - Click "End Session" button (red)
   - Confirm: "End this session permanently for the semester? This cannot be undone."

2. **What Happens:**
   - âœ… Session status changes to "ğŸ”´ Ended (Semester)"
   - âœ… Cannot be reopened
   - âœ… Attendance records preserved
   - âœ… Returns to dashboard

### Visual Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Active Session â”‚
â”‚   ğŸŸ¢ Camera On  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Click "End Session"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ended (Semester)â”‚
â”‚  ğŸ”´ Permanent   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Cannot Reopen
         â–¼
      [FINAL]
```

---

## 3. Reopen Session (12-Hour Retake)

### When Available
- Session is in "Stopped (Daily)" status
- 12 or more hours have passed since stopping

### How It Works
```
Stopped (Daily) â†’ Wait 12h â†’ Reopen Button Appears â†’ Click â†’ Active Again
```

### Steps
1. **Check Dashboard:**
   - Look for sessions with "ğŸŸ  Stopped (Daily)" status
   - If 12+ hours passed: Shows "ğŸ”„ Reopen Session" button
   - If less than 12 hours: Shows "â³ Reopen in X.Xh"

2. **Reopen Session:**
   - Click "ğŸ”„ Reopen Session" button
   - Confirm: "Reopen this session for attendance?"
   - Session becomes active

3. **What Happens:**
   - âœ… Session status changes to "ğŸŸ¢ Active"
   - âœ… Camera can be used again
   - âœ… Old attendance records preserved
   - âœ… New attendance can be taken

### Visual Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Stopped Session Timeline               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Hour 0: Stop Camera
  â”‚
  â”‚  â³ Reopen in 12.0h
  â–¼
Hour 6: Still Waiting
  â”‚
  â”‚  â³ Reopen in 6.0h
  â–¼
Hour 12: Can Reopen!
  â”‚
  â”‚  ğŸ”„ Reopen Session (button appears)
  â–¼
Click Reopen
  â”‚
  â”‚  âœ… Session Active
  â–¼
Take Attendance Again
```

---

## Dashboard Status Indicators

### Session Status Badges

| Badge | Status | Meaning | Actions Available |
|-------|--------|---------|-------------------|
| ğŸŸ¢ Active | Session running | Camera is on, taking attendance | Stop Camera, End Session |
| ğŸŸ  Stopped (Daily) | Waiting to reopen | Stopped for the day | Reopen (after 12h), View Details |
| ğŸ”´ Ended (Semester) | Permanently closed | Cannot be reopened | View Details only |
| â³ Reopen in X.Xh | Countdown active | Waiting for 12 hours | View Details only |

---

## Attendance Records

### How Records Are Stored

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Attendance Database                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  Day 1 (Dec 6):                                 â”‚
â”‚    - Student A: Present (9:00 AM)               â”‚
â”‚    - Student B: Present (9:15 AM)               â”‚
â”‚    - Student C: Absent                          â”‚
â”‚                                                  â”‚
â”‚  [Session Stopped - Wait 12 hours]              â”‚
â”‚                                                  â”‚
â”‚  Day 2 (Dec 7):                                 â”‚
â”‚    - Student A: Present (9:05 AM)               â”‚
â”‚    - Student C: Present (9:20 AM)               â”‚
â”‚    - Student B: Absent                          â”‚
â”‚                                                  â”‚
â”‚  [Session Stopped - Wait 12 hours]              â”‚
â”‚                                                  â”‚
â”‚  Day 3 (Dec 8):                                 â”‚
â”‚    - Student A: Present (9:10 AM)               â”‚
â”‚    - Student B: Present (9:25 AM)               â”‚
â”‚    - Student C: Present (9:30 AM)               â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… All records are PERMANENT
âœ… Reports show complete history
âœ… No data is lost when reopening
```

---

## Common Scenarios

### Scenario 1: Daily Lab Sessions
```
Monday:
  1. Start session at 8:30 AM
  2. Take attendance until 12:00 PM
  3. Click "Stop Camera"
  4. Students marked: 25 present, 5 absent

Tuesday (after 12 hours):
  1. Click "ğŸ”„ Reopen Session"
  2. Take attendance again
  3. Students marked: 28 present, 2 absent
  4. Click "Stop Camera"

Wednesday (after 12 hours):
  1. Click "ğŸ”„ Reopen Session"
  2. Take attendance again
  3. Students marked: 30 present, 0 absent
  4. Click "End Session" (semester end)

Result: Complete attendance history for all 3 days
```

### Scenario 2: Forgot to Take Attendance
```
Problem:
  - Instructor forgot to take attendance on Monday
  - Session was stopped

Solution:
  1. Wait 12 hours
  2. Click "ğŸ”„ Reopen Session"
  3. Take attendance now
  4. Old records preserved
  5. New attendance added
```

### Scenario 3: Technical Issues
```
Problem:
  - Camera not working during session
  - Need to retake attendance

Solution:
  1. Click "Stop Camera" to end current session
  2. Wait 12 hours
  3. Click "ğŸ”„ Reopen Session"
  4. Take attendance with working camera
```

---

## Testing the Feature

### Quick Test (Without Waiting 12 Hours)

1. **Start Test Session:**
   ```bash
   # Login to system as instructor
   # Start a new session
   ```

2. **Stop Camera:**
   ```bash
   # Click "Stop Camera" button
   # Verify status changes to "ğŸŸ  Stopped (Daily)"
   ```

3. **Manually Update Database (for testing):**
   ```sql
   -- Connect to MySQL
   mysql -u root -p smart_attendance
   
   -- Update end_time to 13 hours ago
   UPDATE sessions 
   SET end_time = DATE_SUB(NOW(), INTERVAL 13 HOUR) 
   WHERE id = <session_id>;
   ```

4. **Refresh Dashboard:**
   ```bash
   # Refresh browser (Ctrl+F5)
   # Should now show "ğŸ”„ Reopen Session" button
   ```

5. **Reopen Session:**
   ```bash
   # Click "ğŸ”„ Reopen Session"
   # Verify status changes to "ğŸŸ¢ Active"
   ```

---

## Troubleshooting

### Issue: Cannot see "Reopen" button
**Causes:**
- Less than 12 hours have passed
- Session status is not "stopped_daily"
- Page needs refresh

**Solutions:**
1. Check countdown timer: "â³ Reopen in X.Xh"
2. Wait for countdown to reach 0
3. Refresh page (Ctrl+F5)
4. Check session status in database

### Issue: "Too soon" error when reopening
**Cause:** 12 hours have not passed yet

**Solution:**
- Wait for the remaining time shown in error message
- Or manually update database for testing (see above)

### Issue: Old attendance not showing
**Cause:** Query might be filtering by date

**Solution:**
- Check that reports include all dates
- Verify attendance records exist in database:
  ```sql
  SELECT * FROM attendance WHERE session_id = <id> ORDER BY timestamp DESC;
  ```

---

## Summary

âœ… **Stop Camera** = Daily end, can reopen after 12 hours
âœ… **End Session** = Permanent end, cannot reopen
âœ… **Reopen Session** = Reactivate after 12 hours
âœ… **All attendance records** = Permanently stored
âœ… **Multiple retakes** = Supported with full history

---

## Need Help?

- Check `TIME_BLOCK_SESSIONS_COMPLETE.md` for technical details
- Run `test_session_management.py` to test endpoints
- Contact system administrator for database issues
